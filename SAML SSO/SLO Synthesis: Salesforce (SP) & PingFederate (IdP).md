## SAML SSO/SLO Synthesis: Salesforce (SP) & PingFederate (IdP)

This table provides a comprehensive overview of the SAML 2.0 Single Sign-On (SSO) and Single Logout (SLO) interactions between Salesforce (acting as Service Provider - SP) and PingFederate (acting as Identity Provider - IdP).

**Placeholders Used:**

* `https://<sf-domain>.my.salesforce.com`: Your Salesforce My Domain.
* `https://<sf-community-domain>.com`: Your Salesforce Experience Cloud site domain.
* `https://<pf-idp-hostname.example.com>`: Your PingFederate IdP hostname.
* `<Salesforce_Entity_ID>`: The Entity ID for Salesforce as configured in PingFederate (e.g., `https://<sf-domain>.my.salesforce.com`).
* `<PingFederate_Entity_ID>`: The Entity ID for PingFederate as configured in Salesforce.

**Certificate Notes:**

* **HTTPS/TLS Cert:** Secures the browser-to-server or server-to-server communication channel. Managed by the server owner (Salesforce or PingFederate).
* **SF Signing Cert (PrivKey/PubKey):** Salesforce's SAML certificate used for signing messages. Private key on SF, Public key on PF.
* **PF Signing Cert (PrivKey/PubKey):** PingFederate's SAML certificate used for signing messages. Private key on PF, Public key on SF.
* **SF Encryption Cert (PrivKey/PubKey):** Salesforce's SAML certificate used for assertion encryption. Public key on PF (for encryption), Private key on SF (for decryption).

---

### 1. SP-Initiated Single Sign-On (SSO)

| Step | Description                     | Initiator | Source    | Destination | SAML Message   | Binding        | Primary URL Involved                                                                                             | Certificates Used & Purpose                                                                                                                                                                                                                                                                                          | Key Action                                                                  |
| :--- | :------------------------------ | :-------- | :-------- | :---------- | :------------- | :------------- | :----------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------- |
| 1    | User attempts to access SF      | User      | Browser   | Salesforce  | -              | HTTPS          | `https://<sf-domain>.my.salesforce.com/`                                                                           | **HTTPS/TLS Cert:** Salesforce (secures channel)                                                                                                                                                                                                                                                                     | Request SF resource.                                                        |
| 2    | SF redirects to PF with AuthnReq | Salesforce | Salesforce | Browser     | `AuthnRequest` | HTTP-Redirect  | `https://<pf-idp-hostname.example.com>/idp/SSO.saml2?SAMLRequest=...`                                             | **SF Signing Cert (PrivKey):** SF signs `AuthnRequest`.<br>**HTTPS/TLS Cert:** Salesforce (secures redirect).                                                                                                                                                                                                   | Initiate SSO; send AuthnRequest.                                            |
| 3    | Browser sends AuthnReq to PF    | Browser   | Browser   | PingFederate | `AuthnRequest` | HTTP-Redirect  | `https://<pf-idp-hostname.example.com>/idp/SSO.saml2`                                                              | **HTTPS/TLS Cert:** PingFederate (secures channel).                                                                                                                                                                                                                                                                  | Deliver AuthnRequest to IdP.                                                 |
| 4    | PF verifies AuthnReq signature  | PingFederate | PF        | PF          | -              | -              | N/A (Internal PF process)                                                                                          | **SF Signing Cert (PubKey):** PF verifies `AuthnRequest` signature.                                                                                                                                                                                                                                                  | Validate AuthnRequest origin and integrity.                                 |
| 5    | PF prompts user for auth        | PingFederate | PF        | Browser     | -              | HTTPS          | `https://<pf-idp-hostname.example.com>/pf/adapter/UsernamePasswordLogin.form` (example)                            | **HTTPS/TLS Cert:** PingFederate (secures login page).                                                                                                                                                                                                                                                               | Authenticate user if no active session.                                     |
| 6    | User submits credentials to PF  | User      | Browser   | PingFederate | -              | HTTPS (POST)   | `https://<pf-idp-hostname.example.com>/pf/adapter/UsernamePasswordLogin.form` (example)                            | **HTTPS/TLS Cert:** PingFederate (secures credential submission).                                                                                                                                                                                                                                                    | User provides credentials.                                                  |
| 7    | PF authenticates user           | PingFederate | PF        | PF          | -              | -              | N/A (Internal PF process, may involve LDAP/DB)                                                                     | -                                                                                                                                                                                                                                                                                                                    | Validate user credentials.                                                  |
| 8    | PF generates SAML Assertion     | PingFederate | PF        | PF          | `Assertion`    | -              | N/A (Internal PF process)                                                                                          | **PF Signing Cert (PrivKey):** PF signs `Assertion`.<br>**SF Encryption Cert (PubKey):** PF encrypts `Assertion` (if configured).                                                                                                                                                                              | Create SAML Assertion.                                                      |
| 9    | PF sends Assertion to Browser   | PingFederate | PF        | Browser     | `Assertion`    | HTTP-POST      | (Auto-submitting form from PF to SF ACS URL)                                                                       | **HTTPS/TLS Cert:** PingFederate (secures page with auto-POST form).                                                                                                                                                                                                                                                 | Prepare to send Assertion to SP via browser.                                |
| 10   | Browser POSTs Assertion to SF   | Browser   | Browser   | Salesforce  | `Assertion`    | HTTP-POST      | `https://<sf-domain>.my.salesforce.com/saml/SSO` (SF ACS URL)                                                      | **HTTPS/TLS Cert:** Salesforce (secures channel).                                                                                                                                                                                                                                                                    | Deliver Assertion to SP.                                                    |
| 11   | SF verifies Assertion signature | Salesforce | SF        | SF          | -              | -              | N/A (Internal SF process)                                                                                          | **PF Signing Cert (PubKey):** SF verifies `Assertion` signature.                                                                                                                                                                                                                                                     | Validate Assertion origin and integrity.                                    |
| 12   | SF decrypts Assertion (if any)  | Salesforce | SF        | SF          | -              | -              | N/A (Internal SF process)                                                                                          | **SF Encryption Cert (PrivKey):** SF decrypts `Assertion`.                                                                                                                                                                                                                                                       | Access Assertion content.                                                   |
| 13   | SF processes Assertion, creates session | Salesforce | SF        | SF          | -              | -              | N/A (Internal SF process)                                                                                          | -                                                                                                                                                                                                                                                                                                                    | Identify user, establish session.                                           |
| 14   | SF grants access to resource    | Salesforce | SF        | Browser     | -              | HTTPS          | `https://<sf-domain>.my.salesforce.com/...` (target resource or RelayState)                                        | **HTTPS/TLS Cert:** Salesforce (secures channel).                                                                                                                                                                                                                                                                    | User logged in and accesses resource.                                       |

---

### 2. IdP-Initiated Single Sign-On (SSO)

| Step | Description                     | Initiator | Source    | Destination | SAML Message   | Binding        | Primary URL Involved                                                                                             | Certificates Used & Purpose                                                                                                                                                                                                                                                                                          | Key Action                                                                  |
| :--- | :------------------------------ | :-------- | :-------- | :---------- | :------------- | :------------- | :----------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------- |
| 1    | User accesses PF IdP-Init URL  | User      | Browser   | PingFederate | -              | HTTPS          | `https://<pf-idp-hostname.example.com>/idp/startSSO.ping?PartnerSpId=<Salesforce_Entity_ID>`                      | **HTTPS/TLS Cert:** PingFederate (secures channel).                                                                                                                                                                                                                                                                  | Initiate SSO from IdP.                                                      |
| 2    | PF prompts user for auth        | PingFederate | PF        | Browser     | -              | HTTPS          | `https://<pf-idp-hostname.example.com>/pf/adapter/UsernamePasswordLogin.form` (example)                            | **HTTPS/TLS Cert:** PingFederate (secures login page).                                                                                                                                                                                                                                                               | Authenticate user if no active session.                                     |
| 3    | User submits credentials to PF  | User      | Browser   | PingFederate | -              | HTTPS (POST)   | `https://<pf-idp-hostname.example.com>/pf/adapter/UsernamePasswordLogin.form` (example)                            | **HTTPS/TLS Cert:** PingFederate (secures credential submission).                                                                                                                                                                                                                                                    | User provides credentials.                                                  |
| 4    | PF authenticates user           | PingFederate | PF        | PF          | -              | -              | N/A (Internal PF process)                                                                                          | -                                                                                                                                                                                                                                                                                                                    | Validate user credentials.                                                  |
| 5    | PF generates SAML Assertion     | PingFederate | PF        | PF          | `Assertion`    | -              | N/A (Internal PF process)                                                                                          | **PF Signing Cert (PrivKey):** PF signs `Assertion`.<br>**SF Encryption Cert (PubKey):** PF encrypts `Assertion` (if configured).                                                                                                                                                                              | Create SAML Assertion.                                                      |
| 6    | PF sends Assertion to Browser   | PingFederate | PF        | Browser     | `Assertion`    | HTTP-POST      | (Auto-submitting form from PF to SF ACS URL)                                                                       | **HTTPS/TLS Cert:** PingFederate (secures page with auto-POST form).                                                                                                                                                                                                                                                 | Prepare to send Assertion to SP via browser.                                |
| 7    | Browser POSTs Assertion to SF   | Browser   | Browser   | Salesforce  | `Assertion`    | HTTP-POST      | `https://<sf-domain>.my.salesforce.com/saml/SSO` (SF ACS URL)                                                      | **HTTPS/TLS Cert:** Salesforce (secures channel).                                                                                                                                                                                                                                                                    | Deliver Assertion to SP.                                                    |
| 8    | SF verifies Assertion signature | Salesforce | SF        | SF          | -              | -              | N/A (Internal SF process)                                                                                          | **PF Signing Cert (PubKey):** SF verifies `Assertion` signature.                                                                                                                                                                                                                                                     | Validate Assertion origin and integrity.                                    |
| 9    | SF decrypts Assertion (if any)  | Salesforce | SF        | SF          | -              | -              | N/A (Internal SF process)                                                                                          | **SF Encryption Cert (PrivKey):** SF decrypts `Assertion`.                                                                                                                                                                                                                                                       | Access Assertion content.                                                   |
| 10   | SF processes Assertion, creates session | Salesforce | SF        | SF          | -              | -              | N/A (Internal SF process)                                                                                          | -                                                                                                                                                                                                                                                                                                                    | Identify user, establish session.                                           |
| 11   | SF grants access                | Salesforce | SF        | Browser     | -              | HTTPS          | `https://<sf-domain>.my.salesforce.com/...` (default landing page or RelayState)                                    | **HTTPS/TLS Cert:** Salesforce (secures channel).                                                                                                                                                                                                                                                                    | User logged in and accesses Salesforce.                                     |

---

### 3. SP-Initiated Single Logout (SLO)

| Step | Description                     | Initiator | Source    | Destination | SAML Message    | Binding        | Primary URL Involved                                                                                                 | Certificates Used & Purpose                                                                                                                                | Key Action                                                                  |
| :--- | :------------------------------ | :-------- | :-------- | :---------- | :-------------- | :------------- | :--------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------- |
| 1    | User initiates logout in SF     | User      | Browser   | Salesforce  | -               | HTTPS          | `https://<sf-domain>.my.salesforce.com/secur/logout.jsp`                                                               | **HTTPS/TLS Cert:** Salesforce (secures channel).                                                                                                            | Request logout from SF.                                                     |
| 2    | SF sends `LogoutRequest` to PF  | Salesforce | Salesforce | Browser     | `LogoutRequest` | HTTP-Redirect  | `https://<pf-idp-hostname.example.com>/idp/SLO.saml2?SAMLRequest=...`                                                 | **SF Signing Cert (PrivKey):** SF signs `LogoutRequest`.<br>**HTTPS/TLS Cert:** Salesforce.                                                                    | Initiate SLO; send LogoutRequest to IdP.                                     |
| 3    | PF processes `LogoutRequest`, invalidates IdP session | PingFederate | PF        | PF          | -               | -              | N/A (Internal PF process)                                                                                              | **SF Signing Cert (PubKey):** PF verifies `LogoutRequest` signature.                                                                                         | Validate request; terminate IdP session; initiate logout for other SPs if any. |
| 4    | PF sends `LogoutResponse` to SF | PingFederate | PF        | Browser     | `LogoutResponse`| HTTP-Redirect  | `https://<sf-domain>.my.salesforce.com/services/auth/sp/saml2/logout?SAMLResponse=...` (SF SLO Endpoint)             | **PF Signing Cert (PrivKey):** PF signs `LogoutResponse`.<br>**HTTPS/TLS Cert:** PingFederate.                                                               | Confirm IdP logout to SP.                                                   |
| 5    | SF processes `LogoutResponse`, finalizes logout | Salesforce | SF        | SF          | -               | -              | N/A (Internal SF process)                                                                                              | **PF Signing Cert (PubKey):** SF verifies `LogoutResponse` signature.                                                                                        | Validate response; terminate SF session.                                      |
| 6    | SF redirects user to logout page | Salesforce | SF        | Browser     | -               | HTTPS          | `https://<sf-domain>.my.salesforce.com/` (or configured logout page)                                                   | **HTTPS/TLS Cert:** Salesforce.                                                                                                                              | User logged out.                                                            |

---

### 4. IdP-Initiated Single Logout (SLO)

| Step | Description                     | Initiator | Source    | Destination | SAML Message    | Binding        | Primary URL Involved                                                                                                 | Certificates Used & Purpose                                                                                                                                | Key Action                                                                  |
| :--- | :------------------------------ | :-------- | :-------- | :---------- | :-------------- | :------------- | :--------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------- |
| 1    | User initiates logout at PF     | User      | Browser   | PingFederate | -               | HTTPS          | `https://<pf-idp-hostname.example.com>/idp/startSLO.ping`                                                              | **HTTPS/TLS Cert:** PingFederate (secures channel).                                                                                                          | Request global logout from IdP.                                             |
| 2    | PF invalidates IdP session, sends `LogoutRequest` to SF | PingFederate | PF        | Browser     | `LogoutRequest` | HTTP-Redirect  | `https://<sf-domain>.my.salesforce.com/services/auth/sp/saml2/logout?SAMLRequest=...` (SF SLO Endpoint)               | **PF Signing Cert (PrivKey):** PF signs `LogoutRequest`.<br>**HTTPS/TLS Cert:** PingFederate.                                                                | Terminate IdP session; initiate logout at SP.                                |
| 3    | SF processes `LogoutRequest`, invalidates SF session | Salesforce | SF        | SF          | -               | -              | N/A (Internal SF process)                                                                                              | **PF Signing Cert (PubKey):** SF verifies `LogoutRequest` signature.                                                                                         | Validate request; terminate SF session.                                      |
| 4    | SF sends `LogoutResponse` to PF | Salesforce | Salesforce | Browser     | `LogoutResponse`| HTTP-Redirect  | `https://<pf-idp-hostname.example.com>/idp/SLO.saml2?SAMLResponse=...`                                                 | **SF Signing Cert (PrivKey):** SF signs `LogoutResponse`.<br>**HTTPS/TLS Cert:** Salesforce.                                                                   | Confirm SP logout to IdP.                                                   |
| 5    | PF processes `LogoutResponse` from SF | PingFederate | PF        | PF          | -               | -              | N/A (Internal PF process)                                                                                              | **SF Signing Cert (PubKey):** PF verifies `LogoutResponse` signature.                                                                                        | Validate response; continue SLO for other SPs if any.                        |
| 6    | PF redirects user to logout page| PingFederate | PF        | Browser     | -               | HTTPS          | `https://<pf-idp-hostname.example.com>/sso/logged_out.ping` (example PF logout page)                                   | **HTTPS/TLS Cert:** PingFederate.                                                                                                                            | User logged out.                                                            |

---

**Additional Interesting Columns/Considerations:**

* **Binding Used:** HTTP-Redirect is common for requests and responses that are relatively small and sent via the browser. HTTP-POST is common for sending the SAML Assertion itself. Artifact binding is another option but less common for browser profiles. SOAP binding is used for back-channel communication (not detailed here for browser profiles).
* **SAML Message Key Elements:**
    * **`AuthnRequest`**: `Issuer`, `Destination`, `AssertionConsumerServiceURL`, `ProtocolBinding`, `ID`, `NameIDPolicy`.
    * **`Assertion`**: `Issuer`, `Subject` (`NameID`, `SubjectConfirmation`), `Conditions` (`AudienceRestriction`), `AuthnStatement` (`AuthnContext`), `AttributeStatement`, `Signature`.
    * **`LogoutRequest`**: `Issuer`, `Destination`, `ID`, `NameID`, `SessionIndex`.
    * **`LogoutResponse`**: `Issuer`, `Destination`, `ID`, `InResponseTo`, `Status`.
* **Error Handling:** Not detailed, but SAML `Status` codes in responses indicate success or failure (e.g., `urn:oasis:names:tc:SAML:2.0:status:Success`, `urn:oasis:names:tc:SAML:2.0:status:Requester`, `urn:oasis:names:tc:SAML:2.0:status:Responder`).
* **RelayState:** An opaque parameter used to maintain state between the IdP and SP across redirects, often used to redirect the user to a specific resource after successful SSO.
* **Session Management:** Both IdP and SP maintain their own sessions. SAML helps link these sessions. `SessionIndex` in `AuthnStatement` and `LogoutRequest` helps identify the specific IdP session to be terminated during SLO.
* **Metadata:** SAML metadata files are crucial for exchanging configuration details (Entity IDs, endpoint URLs, public certificates) between Salesforce and PingFederate, simplifying setup and reducing errors.

This table should serve as a robust reference for understanding the SAML interactions between Salesforce and PingFederate.

